<div class="content">
  Parameter Maintenance
</div>

<div class="query-row">
  <!-- 厂别 -->
  <div class="field1">
    <span style="width: 29%;">
      <span style="color: red;">*</span>
      <span>Site</span>
    </span>
    <nz-select nzShowSearch nzAllowClear [(ngModel)]="cur_site" (ngModelChange)="getOptions('plant')">
      <nz-option *ngFor="let site of objectKeys(siteGroup)" [nzLabel]="site" [nzValue]="site"></nz-option>
    </nz-select>
  </div>

  <!-- 厂区 -->
  <div class="field" (click)="getOptList('plant')">
    <span style="width: 28%;">
      <span style="color: red">*</span>
      <span>Plant</span>
    </span>
    <nz-select nzShowSearch nzAllowClear [(ngModel)]="cur_plant" (ngModelChange)="getOptions('category')">
      <nz-option *ngFor="let plant of plantGroup" [nzLabel]="plant" [nzValue]="plant"></nz-option>
    </nz-select>
  </div>

  <!-- 类别 -->
  <div class="field" (click)="getOptList('category')">
    <span style="width: 28%;">
      <span>Category</span>
    </span>
    <nz-select nzShowSearch nzAllowClear [(ngModel)]="cur_category" (ngModelChange)="getOptions('stage')">
      <nz-option *ngFor="let category of objectKeys(categoryGroup)" [nzLabel]="category" [nzValue]="category"></nz-option>
    </nz-select>
  </div>

  <!-- 站别 -->
  <div class="field" (click)="getOptList('stage')">
    <span style="width: 28%;">
      <span>Stage</span>
    </span>
    <nz-select nzShowSearch nzAllowClear [(ngModel)]="cur_stage" (ngModelChange)="getOptions('model')">
      <nz-option *ngFor="let stage of objectKeys(stageGroup)" [nzLabel]="stage" [nzValue]="stage"></nz-option>
    </nz-select>
  </div>

  <!-- 机种 -->
  <div class="field" (click)="getOptList('model')">
    <span style="width: 28%;">
      <span>Model</span>
    </span>
    <nz-select nzShowSearch nzAllowClear [(ngModel)]="cur_model">
      <nz-option *ngFor="let model of objectKeys(modelGroup)" [nzLabel]="model" [nzValue]="model"></nz-option>
    </nz-select>
  </div>


  <!-- <div class="field" (click)="getOptList('model')">
    <span>Model</span>
    <nz-select style="width: 75%;" nzShowSearch nzAllowClear nzMode="multiple" [(ngModel)]="cur_model"
      (ngModelChange)="getOptions('query')">
      <nz-option *ngFor="let model of objectKeys(modelGroup)" [nzLabel]="model" [nzValue]="model"></nz-option>
    </nz-select>
  </div> -->

  <button nz-button nzType="primary" style="border-radius:6px" (click)="query()" [disabled]="queryButton">Query</button>
</div>
<nz-divider style="background-color:rgba(212, 212, 212, 1);"></nz-divider>
<!-- <div *ngIf="role['insert'] === true" style="float: left;margin-right: 10px;">
  <button nz-button [nzType]="'primary'" title="新增" nzShape="circle" (click)="showModal()" style="margin-bottom: 15px;">
      <i class="anticon anticon-plus"></i>
  </button>
</div> -->
<button nz-button [nzType]="'primary'" title="Upload Template Download" nzShape="circle" (click)="downloadTemp()"
  style="margin-bottom: 15px; margin-right: 10px;">
  <i nz-icon type="file-excel" theme="outline"></i>
</button>
<button nz-button [nzType]="'primary'" *ngIf="ckpiInfos && ckpiInfos.length > 0" title="Download" nzShape="circle"
  (click)="downloadData()" style="margin-bottom: 15px;">
  <i nz-icon type="download" theme="outline"></i>
</button>
<div class="btn-upload" *ngIf="role['insert'] === true">
  <label class="upload">
    <input id="upload" type="file" (change)="handleFileInput($event.target)">
    <div class="fakeInput">
      <span *ngIf="uploadFileName">{{uploadFileName}}</span>
      <span *ngIf="!uploadFileName">Select Excel File</span>
    </div>
  </label>

  <label style="padding:4px 15px;" class="ant-btn ant-btn-primary ant-btn-icon-only ant-input-search-button upload"
    title="Upload" (click)="uploadPre()">
    <i class="anticon anticon-upload"></i>
  </label>
  <span style="margin-left: 2%; font-size: 15px; font-weight: 900;"><span style="font-size: 18px; font-weight: 900; color: blue;">Remark:</span> For EOL product, Please remove its test item immediately. </span>
</div>
<div class="upload-progress" [hidden]="showProgress">
  <nz-progress [nzPercent]="progressBar" nzSize="small" [nzStatus]="proStatus"></nz-progress>
</div>

<!-- 可编辑的table -->

<nz-table #nzData nzBordered nzShowQuickJumper [nzData]="ckpiInfos" [nzPageSize]="10" [nzWidthConfig]="THwidth"
  [(nzPageIndex)]="curPage" [nzScroll]="{ x:'1390px'}">
  <thead>
    <tr style="font-size: 12px;">
      <th>No.</th>
      <th>Plant ID</th>
      <th>Category</th>
      <th>Screen Parameter</th>
      <th>Model Name</th>
      <th>Stage</th>
      <th>Test Item</th>
      <th>Sub Test Item</th>
      <th>Goal</th>
      <th>PIC</th>
      <th>Update Date</th>
      <th>Create Date</th>
      <th nzRight="40px">Action</th>
      <th nzRight="0px">log</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of nzData.data;  let i = index;" style="font-size: 12px;">
      <td>{{(curPage - 1) * 10 + i + 1}}</td>

      <td>
        {{data.plant}}
      </td>

      <td>
        <ng-container>
          {{data.project}}
        </ng-container>
      </td>

      <td>
        <ng-container *ngIf="editMap.get(data['id'])">
          <input type="text" nz-input [(ngModel)]="editItem['screenParameter']">
        </ng-container>
        <ng-container *ngIf="!editMap.get(data['id'])">
          {{data.screenParameter}}%
        </ng-container>
      </td>

      <td>
        <ng-container>
          {{data.modelname}}
        </ng-container>
      </td>

      <td>
        <ng-container>
          {{data.stationtype}}
        </ng-container>
      </td>

      <td>
        <ng-container>
          {{data.tdname}}
        </ng-container>
      </td>

      <td>
        <ng-container>
          {{data.mdname}}
        </ng-container>
      </td>

      <td>
        <ng-container *ngIf="editMap.get(data['id']) && data['project'] === 'ppk'">
          <input type="text" nz-input [(ngModel)]="editItem['goal']">
        </ng-container>
        <ng-container *ngIf="!editMap.get(data['id'])">
          {{data.goal}}
        </ng-container>
      </td>

      <td>{{data.updatedUser}}</td>
      <td>{{data.updatedTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
      <td>{{data.createdTime | date: 'yyyy-MM-dd HH:mm:ss'}}</td>

      <!-- Action列 对应的 编辑、删除功能 -->
      <td *ngIf="role['update'] === true && !editMap.get(data['id'])&&!disableedit">
        <span style="float: left;
        padding-right: 8px;" (click)="editRow(data)"><i class="anticon anticon-edit"></i></span>
        <nz-divider class="table-divider" nzType="vertical"></nz-divider>
        <nz-popconfirm [nzTitle]="'Sure to delete?'" (nzOnConfirm)="delRow(data.id)">
          <a nz-popconfirm><i class="anticon anticon-delete" style="margin-left: 10px;"></i></a>
        </nz-popconfirm>
      </td>
      <td *ngIf="role['update'] !== true">
        No Permissions
      </td>

      <td *ngIf="role['update'] === true && editMap.get(data['id'])">
        <span style="float: left;
          padding-right: 8px;" (click)="saveRow(editItem, data)"><i class="anticon anticon-save"></i></span>
        <nz-divider class="table-divider" nzType="vertical"></nz-divider>
        <span style="padding-left: 8px;cursor: pointer;"><i class="anticon anticon-rollback" (click)="cancelEdit(data)"
            style="margin-left: 10px;"></i></span>
      </td>
      <td *ngIf="role['update'] !== true && !editMap.get(data['id'])&&disableedit">
        <span style="float: left;
              padding-right: 8px;cursor: no-drop"><i class="anticon anticon-edit"></i></span>
        <nz-divider class="table-divider" nzType="vertical"></nz-divider>
        <span style="padding-left: 8px;cursor: no-drop"><i class="anticon anticon-delete"
            style="margin-left: 10px;"></i></span>
      </td>
      <td>
        <span>
          <i nz-icon type="search" theme="outline" (click)="showLog(data.id)"></i>
        </span>
      </td>

    </tr>
  </tbody>
</nz-table>

<!-- log弹出框 -->
<nz-modal [(nzVisible)]="isVisible_log" nzTitle="Detail Log" nzClosable="false" [nzFooter]="footer" nzWidth="85%"
  (nzOnCancel)="handleCancel_log()" (nzOnOk)="handleOk_log()">
  <nz-table #nzDatalog nzBordered nzShowQuickJumper [nzData]="logInfos" [nzPageSize]="10" [nzWidthConfig]="THwidth"
    [(nzPageIndex)]="curPagelog" [nzScroll]="{ x:'1390px'}">
    <thead>
      <tr style="font-size: 12px;">
        <th>No.</th>
        <th>Plant ID</th>
        <th>Category</th>
        <th>Screen Parameter</th>
        <th>Model Name</th>
        <th>Stage</th>
        <th>Test Item</th>
        <th>Sub Test Item</th>
        <th>Goal</th>
        <th>PIC</th>
        <th>Update Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of nzDatalog.data;  let k = index;" style="font-size: 12px;">
        <td>{{(curPagelog - 1) * 10 + k + 1}}</td>
        <td>{{data.plant}}</td>
        <td>{{data.project}}</td>
        <td>{{data.screenParameter}}%</td>
        <td>{{data.modelname}}</td>
        <td>{{data.stationtype}}</td>
        <td>{{data.tdname}}</td>
        <td>{{data.mdname}}</td>
        <td>{{data.goal}}</td>
        <td>{{data.updatedUser}}</td>
        <td>{{data.updatedTime | date:'yyyy/MM/dd HH:mm:ss'}}</td>
        <td>{{data.actions}}</td>
      </tr>
    </tbody>
  </nz-table>
</nz-modal>
