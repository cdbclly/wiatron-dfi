<nz-breadcrumb>
  <nz-breadcrumb-item>DFQ System</nz-breadcrumb-item>
  <nz-breadcrumb-item>{{ 'dfq.rfi-new-model-yield-forecast' | translate }}</nz-breadcrumb-item>
  <nz-breadcrumb-item>{{ 'dfq.rfi-data-maintain' | translate }}</nz-breadcrumb-item>
  <nz-breadcrumb-item>{{ 'dfq.rfi-yrfactor-maintain' | translate }}</nz-breadcrumb-item>
</nz-breadcrumb>
<div class="content">{{ 'dfq.rfi-yrfactor-maintain' | translate }}</div>
<div>
  <form nz-form [nzLayout]="'inline'" [formGroup]="validatorForm" (ngSubmit)="query()">
    <nz-form-item>
      <nz-form-label nzRequired>{{ 'dfq.dfq-product' | translate }}</nz-form-label>
      <nz-form-control class="formselect-cls" nzErrorTip="product cannot be empty">
        <nz-select nzShowSearch nzAllowClear formControlName="productId" [(ngModel)]="selectedProduct"
          (ngModelChange)="changeProduct($event)">
          <ng-container *ngFor="let product of products">
            <nz-option [nzValue]="product.id" [nzLabel]="product.id"></nz-option>
          </ng-container>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label >{{ 'dfq.dfq-material' | translate }}</nz-form-label>
      <nz-form-control class="formselect-cls" >
        <nz-select nzShowSearch nzAllowClear nzLoading formControlName="materialId" [(ngModel)]="selectedMaterial">
          <ng-container *ngFor="let material of materialList">
            <nz-option [nzValue]="material.id" [nzLabel]="material.name"></nz-option>
          </ng-container>
        </nz-select>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-control>
        <button nz-button nzType="primary" [nzLoading]="isLoading" [disabled]="!validatorForm.valid">{{ 'dfq.dfq-query' | translate }}</button>
      </nz-form-control>
    </nz-form-item>
  </form>
  <nz-divider style="background-color:rgba(212, 212, 212, 1);"></nz-divider>
  <div>
    <nz-progress *ngIf="uploading" [nzPercent]="uploadCount/uploadTotal*100 | number:3.0-3" nzType="circle"
      nzStatus="{{uploadStatus}}"></nz-progress>
    <div class="dfc-btn" *ngIf="showMaterialList">
      <div class="dfc-btn-right">
        <!-- <div><span *ngIf="finishUp">已上傳數:{{uploadCount}}</span></div> -->
        <div class="dfc-btn-upload">
          <div class="dfc-btn-download">
            <button nz-button [nzType]="'primary'" title="download" nzShape="circle" (click)="download()">
              <i class="anticon anticon-download"></i>
            </button>
          </div>
          <div class="field">
              <nz-spin nzSimple [nzSpinning]="uploading">
                <label class="upload" >
                  <input id="upload" type="file" (change)="handleUploadFile($event.target)" />
                  <div class="fakeInput">
                    <span *ngIf="uploadFileName">{{ uploadFileName }}</span>
                    <span *ngIf="!uploadFileName">Select Excel file</span>
                  </div>
                </label>
                <label class="ant-btn ant-btn-primary ant-btn-icon-only ant-input-search-button upload" title="upload"
                  (click)="upload()">
                  <i class="anticon anticon-upload"></i>
                </label>
              </nz-spin>
            </div>
        </div>
      </div>
    </div>
    <!-- <nz-divider style="background-color:rgba(212, 212, 212, 1);"></nz-divider> -->
    <div class="options">
      <div class="options-table" *ngIf="showMaterialList">
        <nz-table #nzTable [nzData]="[1]" nzShowPagination="false" [nzNoResult]="true" [nzPageSize]="5000">
          <thead>
            <tr>
              <th>{{ 'dfq.dfq-material' | translate }}</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let material of Materials">
              <td (click)="clickMaterial(material)">{{material.name}}</td>
              <td>
                <div>
                  <a (click)="editMaterial(material)"><i nz-icon type="edit" theme="outline"></i></a>&nbsp;&nbsp;
                  <nz-switch [(ngModel)]="material.enabled" (ngModelChange)="enableMaterial(material)"
                    [nzLoading]="isLoading"></nz-switch>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div class="add">
                  <button nz-button nzType="primary" nzShape="circle" (click)="addMaterial()">
                    <i nz-icon type="plus" theme="outline"></i>
                  </button>
                </div>
              </td>
              <td></td>
            </tr>
          </tbody>
        </nz-table>
        <div>

          <nz-modal nzWidth="350px" [(nzVisible)]="addMaterialFlag" [nzTitle]="modalTitle" [nzContent]="modalContent"
            [nzFooter]="modalFooter" (nzOnCancel)="addMaterialCancel()">
            <ng-template #modalTitle>
              {{ 'dfq.dfq-add' | translate }}{{ 'dfq.dfq-material' | translate }}
            </ng-template>
            <ng-template #modalContent>
              <div class="input">
                <span>{{ 'dfq.dfq-material' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="addMaterialData">
              </div>
              <!-- <div class="input">
                <span>編碼</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched" [(ngModel)]="processForm.id">
              </div> -->
            </ng-template>
            <ng-template #modalFooter>
              <button nz-button nzType="primary" (click)="addMaterialCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="materialModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>

          <nz-modal nzWidth="350px" [(nzVisible)]="updateMaterialFlag" [nzTitle]="modalTitle1"
            [nzContent]="modalContent1" [nzFooter]="modalFooter1" (nzOnCancel)="UPMaterialCancel()">
            <ng-template #modalTitle1>
              {{ 'dfq.dfq-modify' | translate }}
            </ng-template>
            <ng-template #modalContent1>
              <div class="input">
                <span>{{ 'dfq.dfq-material' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="updateMaData">
              </div>
              <!-- <div class="input">
              <span>編碼</span>
              <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched" [(ngModel)]="processForm.id">
            </div> -->
            </ng-template>
            <ng-template #modalFooter1>
              <button nz-button nzType="primary" (click)="upMaterialCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="upMaterialModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>
        </div>
      </div>

      <div class="options-table" *ngIf="tableShow2">
        <nz-table #nzTable [nzData]="[1]" nzShowPagination="false" [nzPageSize]="5000">
          <thead>
            <tr>
              <th style="width: 130px">{{ 'dfq.rfi-factor-type' | translate }}</th>
              <th>Action &nbsp; <table  class="tableShow" (click)="closeFacterType()"><i nz-icon type="close" theme="outline"></i></table></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let factorType of factorTypes">
              <td (click)="clickFactorType(factorType)">{{factorType.name}}</td>
              <td>
                <div>
                  <a (click)="editFType(factorType)"><i nz-icon type="edit" theme="outline"></i></a>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div class="add"><button nz-button nzType="primary" nzShape="circle" (click)="addFactorType()"><i
                      nz-icon type="plus" theme="outline"></i></button></div>
              </td>
              <td>{{ 'dfq.dfq-material' | translate }}:{{onMaterial}}</td>
            </tr>
          </tbody>
        </nz-table>
        <div>
          <nz-modal nzWidth="350px" [(nzVisible)]="addFacorTypeFlag" [nzTitle]="modalTitle3" [nzContent]="modalContent3"
            [nzFooter]="modalFooter3" (nzOnCancel)="FactorTypeCancel()" [nzOkLoading]="factorTypeOkloding">
            <ng-template #modalTitle3>
              {{ 'dfq.dfq-add' | translate }}{{ 'dfq.rfi-factor-type' | translate }}
            </ng-template>
            <ng-template #modalContent3>
              <div class="input">
                <span>{{ 'dfq.rfi-factor-type' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="addFactorTypeData">
              </div>
            </ng-template>
            <ng-template #modalFooter3>
              <button nz-button nzType="primary" (click)="addFactorTypeCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="factorTypeModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>

          <nz-modal nzWidth="350px" [(nzVisible)]="updateFTypeFlag" [nzTitle]="modalTitle4" [nzContent]="modalContent4"
            [nzFooter]="modalFooter4" (nzOnCancel)="UPFTypeCancel()">
            <ng-template #modalTitle4>
              {{ 'dfq.dfq-modify' | translate }}
            </ng-template>
            <ng-template #modalContent4>
              <div class="input">
                <span>{{ 'dfq.rfi-factor-type' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="updateFTypeName">
              </div>
            </ng-template>
            <ng-template #modalFooter4>
              <button nz-button nzType="primary" (click)="upFTypeCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="updateFTypeModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>

        </div>
      </div>



      <div class="options-table" *ngIf="tableShow3">
        <nz-table #nzTable [nzData]="[1]" nzShowPagination="false" [nzPageSize]="5000">
          <thead>
            <tr>
              <th>{{ 'dfq.rfi-factor' | translate }}</th>
              <th>Action &nbsp; <table class="tableShow" (click)="closeFacter()"><i nz-icon type="close" theme="outline"></i></table></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let factor of factors">
              <td>{{factor.name}}</td>
              <td>
                <div>
                  <a (click)="editFactor(factor)"><i nz-icon type="edit" theme="outline"></i></a>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div class="add">
                  <div class="add"><button nz-button nzType="primary" nzShape="circle" (click)="addFactor()"><i nz-icon
                        type="plus" theme="outline"></i></button></div>
                </div>
              </td>
              <td>{{ 'dfq.rfi-factor-type' | translate }}:{{onFactorType}}</td>
            </tr>
          </tbody>
        </nz-table>
        <div>
          <nz-modal nzWidth="350px" [(nzVisible)]="addFacorFlag" [nzTitle]="modalTitle5" [nzContent]="modalContent5"
            [nzFooter]="modalFooter5" (nzOnCancel)="addFCancel()">
            <ng-template #modalTitle5>
              {{ 'dfq.dfq-add' | translate }}{{ 'dfq.rfi-factor' | translate }}
            </ng-template>
            <ng-template #modalContent5>
              <div class="input">
                <span>{{ 'dfq.rfi-factor' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="addFactorName">
              </div>
            </ng-template>
            <ng-template #modalFooter5>
              <button nz-button nzType="primary" (click)="addFactorCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="FactorModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>

          <nz-modal nzWidth="350px" [(nzVisible)]="updateFacorFlag" [nzTitle]="modalTitle6" [nzContent]="modalContent6"
            [nzFooter]="modalFooter6" (nzOnCancel)="updateFCancel()">
            <ng-template #modalTitle6>
              {{ 'dfq.dfq-modify' | translate }}
            </ng-template>
            <ng-template #modalContent6>
              <div class="input">
                <span>{{ 'dfq.rfi-factor' | translate }}</span>
                <input nz-input="" placeholder="" class="ng-pristine ng-valid ant-input ng-touched"
                  [(ngModel)]="updateFactorName">
              </div>
            </ng-template>
            <ng-template #modalFooter6>
              <button nz-button nzType="primary" (click)="updateFactorCancel()">{{ 'dfq.dfq-return' | translate }}</button>
              <button nz-button nzType="primary" (click)="updateFactorModelOk()">{{ 'dfq.dfq-save' | translate }}</button>
            </ng-template>
          </nz-modal>
        </div>
      </div>
    </div>
  </div>
