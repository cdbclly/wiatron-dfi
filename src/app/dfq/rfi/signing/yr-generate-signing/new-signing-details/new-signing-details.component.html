<div class="divALL">
  <div class="div1">
    <table class="tableall">
      <tr>
        <td class="td-title">{{ 'dfq.dfq-plant' | translate }}</td>
        <td class="td-context">{{data.site}}-{{data.plant}}</td>
        <td class="td-title">{{ 'dfq.dfq-customer' | translate }}</td>
        <td class="td-context">{{data.customer}}</td>
        <td class="td-title">{{ 'dfq.dfq-product' | translate }}</td>
        <td class="td-context">{{data.product}}</td>
        <td class="td-title">Project Code</td>
        <td class="td-context">{{data.project}}</td>
      </tr>
      <tr>
        <td class="td-title">{{ 'dfq.rfi-sign-sender' | translate }}</td>
        <td class="td-context">{{createBy | userEnname | async}}</td>
        <td class="td-title">{{ 'dfq.rfi-signing-time' | translate }}</td>
        <td class="td-context">{{createOn | datetime}}</td>
      </tr>
    </table>
    <nz-divider></nz-divider>
  </div>
  <div class="div2">
    <div class="echarts-cls" *ngIf="showEcharts"  echarts [options]="targetYrOptions"  (chartClick)="getEchart()"  >
    </div>
    <div>
      <button nz-button nzType="primary" style="margin-bottom: 2px" [nzLoading]="!tableShow"
        [disabled]="data.status!=0 || !signEnable"
        (click)="editMBsignOk()">{{ 'dfq.dfq-sign-off' | translate }}</button>
      <div>
        <nz-table #rowSelectionTable nzShowSizeChanger [nzData]="listOfAllData" [nzLoading]="!tableShow"
          (nzCurrentPageDataChange)="currentPageDataChange($event)" [nzShowPagination]="false" [nzPageSize]=999>
          <thead>
            <tr>
              <th nzShowCheckbox [(nzChecked)]="isAllDisplayDataChecked" [nzIndeterminate]="isIndeterminate"
                (nzCheckedChange)="checkAll($event)"></th>
              <th>{{ 'dfq.dfq-signer' | translate }}</th>
              <th style="width: 20%">{{ 'dfq.dfq-material' | translate }}</th>
              <th>{{ 'dfq.dfq-design-yield' | translate }}</th>
              <th>{{ 'dfq.rfi-best-yield' | translate }}</th>
              <th>{{ 'dfq.rfi-discuss-improved-yield' | translate }}</th>
              <th>{{ 'dfq.rfi-discussion-notes' | translate }}</th>
              <th>{{ 'dfq.rfi-sign-off-information' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of rowSelectionTable.data">
              <td [nzDisabled]="data.workflow && data.workflow[0].status !=0" nzShowCheckbox
                [(nzChecked)]="mapOfCheckedId[data.id]" (nzCheckedChange)="refreshStatus()"></td>
              <td>{{ data.userId | userEnname | async }}</td>
              <td>{{ data.materialName }}</td>
              <td>{{ data.originalYieldRate | percent }}</td>
              <td>{{ data.bestYieldRate | percent }}</td>
              <td>{{ data.yieldRate | percent }}</td>
              <td>{{ data.discussion }}</td>
              <td><a (click)="showDetails(data.workflow[0])">{{ 'dfq.rfi-details' | translate }}</a></td>
            </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>

  <nz-modal nzWidth="500px" [(nzVisible)]="showSignatureModal" [nzTitle]="modalTitle1" [nzContent]="modalContent1"
    (nzOnCancel)="cancalSignature()" [nzFooter]="modalFooter2">
    <ng-template #modalTitle1>{{ 'dfq.dfq-sign-off' | translate }}</ng-template>
    <ng-template #modalContent1>
      <div>
        <textarea nz-input [disabled]="false" nzWidth="400px" [(ngModel)]="comments" class="select2"
          id="comments"></textarea>
      </div>
    </ng-template>
    <ng-template #modalFooter2>
      <button nz-button nzType="primary" [nzLoading]="isLoading" [disabled]="false"
        (click)="sign(true, comments)">Approve</button>
      <button nz-button nzType="primary" [nzLoading]="isLoading" [disabled]="false"
        (click)="sign(false, comments)">Reject</button>
    </ng-template>
  </nz-modal>

  <nz-modal nzWidth="800px" [(nzVisible)]="showDetail" [nzTitle]="modalTitle2" [nzContent]="modalContent2"
    (nzOnCancel)="cancelSign()" [nzFooter]="null">
    <ng-template #modalTitle2>{{ 'dfq.rfi-sign-off-information' | translate }}</ng-template>
    <ng-template #modalContent2>
      <nz-table #rowSelectionTable [nzData]="listOfAllData" [nzShowPagination]="false">
        <thead>
          <tr>
            <th>{{ 'dfq.dfq-signer' | translate }}</th>
            <th>{{ 'dfq.rfi-approval-date' | translate }}</th>
            <th>{{ 'dfq.dfq-sing-status' | translate }}</th>
            <th>{{ 'dfq.rfi-sign-off notes' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of showData">
            <td>{{ data.userId | userEnname | async }}</td>
            <td>{{ data.updateOn ? (data.updateOn | datetime) : '' }}</td>
            <td>{{ data.isAgree ? 'Approve' : 'Reject' }}</td>
            <td>{{ data.comment }}</td>
          </tr>
        </tbody>
      </nz-table>
    </ng-template>
  </nz-modal>
