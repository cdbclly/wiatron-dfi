<div class="dfc-query">
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.plant" [(queryValue)]="selectValue.plant"
      [querySelect]="querySelect.plant" (queryValueChange)="changePlant()"></app-dfc-query-input>
  </div>
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.custom" [(queryValue)]="selectValue.custom"
      [querySelect]="querySelect.custom" (queryValueChange)="changeCustomAndModelType()"
      (searchSelectChange)="customSearch($event)"></app-dfc-query-input>
  </div>
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.modelType" [(queryValue)]="selectValue.modelType"
      [querySelect]="querySelect.modelType" (queryValueChange)="changeCustomAndModelType()"></app-dfc-query-input>
  </div>
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.proName" [(queryValue)]="selectValue.proName"
      [querySelect]="querySelect.proName" (searchSelectChange)="proNameSearch($event)"
      (queryValueChange)="changeProName($event)"></app-dfc-query-input>
  </div>
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.proCode" [(queryValue)]="selectValue.proCode"
      [querySelect]="querySelect.proCode" (searchSelectChange)="proCodeSearch($event)"></app-dfc-query-input>
  </div>
  <div>
    <app-dfc-query-input [queryStyle]="queryStyle.model" [(queryValue)]="selectValue.model"
      [querySelect]="querySelect.model" (searchSelectChange)="modelSearch($event)"></app-dfc-query-input>
  </div>
  <div class="dfc-query-btn">
    <button nz-button style="width: 83px;" nzType="primary" [nzLoading]="queryLoading"
      (click)="query()">{{'mrr.mrr-query' | translate}}</button>
    <button nz-button [nzType]="'primary'" title="Download" nzShape="circle" (click)="download()">
      <i class="anticon anticon-download"></i>
    </button>
  </div>
</div>
<div class="workHour-table">
  <nz-table id="mohData" #dfcSummaryMohTable [nzWidthConfig]="nzWidthConfig" [nzData]="dataSet" [nzScroll]="nzScrollRep"
    [nzFrontPagination]=tablePaging [nzPageSize]="10" nzBordered>
    <thead>
      <tr>
        <th rowspan="2">{{'mrr.vendor-extension' | translate}}</th>
        <th rowspan="2">{{'mrr.mrr-site' | translate}}</th>
        <th rowspan="2">{{'mrr.mrr-customer' | translate}}</th>
        <th rowspan="2">{{'mrr.mrr-product' | translate}}</th>
        <th rowspan="2">Project Code</th>
        <th rowspan="2">Project Name</th>
        <th rowspan="2">Model Name</th>
        <th rowspan="2">Current Stage</th>
        <th rowspan="2">MP Date</th>
        <th rowspan="2">FCST(K/{{'military-order.month' | translate}})</th>
        <th rowspan="1" colspan="2">RFQ</th>
        <th rowspan="1">C0</th>
        <th rowspan="1">C1</th>
        <th rowspan="1">C2</th>
        <th rowspan="1">C3</th>
        <th rowspan="1">C4</th>
        <th rowspan="1">C5</th>
        <th rowspan="1">C6</th>
      </tr>
      <tr>
        <th>{{'report.dfc-am-quoted-price' | translate}}</th>
        <th>{{'report.goal-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
        <th>{{'report.design-moh' | translate}}</th>
      </tr>
    </thead>
    <tbody>
      <ng-template ngFor let-row [ngForOf]="dfcSummaryMohTable.data">
        <tr>
          <!-- 如果為 groupModel 則顯示展開的加號 -->
          <td *ngIf="!row[2]"></td>
          <td nzShowExpand [(nzExpand)]="row[0]" *ngIf="row[2]" (nzExpandChange)="nzExpandChange($event,row)"></td>
          <ng-container *ngFor="let col of row; index as i">
            <ng-container *ngIf="isColIndex(i)">
              <ng-container *ngIf="!isObjectType(col)">
                <!--解析基礎類型-->
                <td>{{col}}</td>
              </ng-container>
              <ng-container *ngIf="isObjectType(col)">
                <!--解析引用類型-->
                <ng-container *ngIf="!col.click">
                  <!--解析引用類型中的不可點擊的-->
                  <ng-container *ngIf="i === 10">
                    <!--解析不可點擊的RFQ-->
                    <td>{{col.cost}}</td>
                    <td>{{col.target}}</td>
                  </ng-container>
                  <ng-container *ngIf="i !== 10">
                    <!--解析的其他不可點擊製程-->
                    <td>{{col.cost}}</td>
                  </ng-container>
                </ng-container>
                <ng-container *ngIf="col.click">
                  <!--解析引用類型中可以點擊的-->
                  <ng-container *ngIf="i === 10">
                    <!--解析可以點擊的RFQ-->
                    <td>{{col.cost}}</td>
                    <td>
                      <a [routerLink]="['/dashboard/dfc/model-moh']"
                        [queryParams]="{modelID: row[3]['modelID'], stage: row[10], modelGroupType: row[3]['groupType'], plant: col.plant, modelType: col.modelType, standardType: col.check, modelName: row[3]['modelName']}"
                        style="text-decoration: underline" target="_blank">
                        {{col.target}}
                      </a>
                    </td>
                  </ng-container>
                  <ng-container *ngIf="i !== 10">
                    <!--解析其他可以點擊製程-->
                    <td>
                      <a [routerLink]="['/dashboard/dfc/model-moh']"
                        [queryParams]="{modelID: row[3]['modelID'], stage: row[10], modelGroupType: row[3]['groupType'], plant: col.plant, modelType: col.modelType, standardType: col.check, modelName: row[3]['modelName']}"
                        [ngStyle]="col.style" style="text-decoration: underline" target="_blank">
                        {{col.cost}}
                      </a>
                    </td>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
        </tr>
        <tr [nzExpand]="row[0]">
          <td></td>
          <td colspan="19">
            <nz-table #innerTable [nzData]="row[1]" [nzShowPagination]="false">
              <thead>
                <tr>
                  <th rowspan="2">Model Name</th>
                  <th rowspan="2">Count</th>
                  <th rowspan="2">FCST(K/{{'military-order.month' | translate}})</th>
                  <th rowspan="1" colspan="2">RFQ</th>
                  <th rowspan="1">C0</th>
                  <th rowspan="1">C1</th>
                  <th rowspan="1">C2</th>
                  <th rowspan="1">C3</th>
                  <th rowspan="1">C4</th>
                  <th rowspan="1">C5</th>
                  <th rowspan="1">C6</th>
                </tr>
                <tr>
                  <th>{{'report.dfc-am-quoted-price' | translate}}</th>
                  <th>{{'report.goal-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                  <th>{{'report.actual-moh' | translate}}</th>
                </tr>
              </thead>
    <tbody>
      <tr *ngFor="let innerRow of innerTable.data">
        <ng-container *ngFor="let innerCol of innerRow; index as iCol">
          <!-- 基礎類型直接顯示 -->
          <ng-container *ngIf="!isInnerType(iCol)">
            <td>{{(innerCol.basicModel | dfcBasicModel | async)?.modelName}}</td>
            <td>{{innerCol.count}}</td>
            <td>{{(innerCol.basicModel | dfcBasicModel | async)?.FCST}}</td>
          </ng-container>
          <ng-container *ngIf="isInnerType(iCol)">
            <ng-container *ngIf="iCol === 1">
              <td>{{innerCol}}</td>
            </ng-container>
            <ng-container *ngIf="iCol !== 1">
              <!--解析引用類型-->
              <ng-container *ngIf="!innerCol.click">
                <!--解析引用類型中的不可點擊的-->
                <ng-container *ngIf="iCol === 2">
                  <!--解析不可點擊的RFQ-->
                  <td>{{innerCol.target}}</td>
                </ng-container>
                <ng-container *ngIf="iCol !== 2">
                  <!--解析的其他不可點擊製程-->
                  <td>{{innerCol.cost}}</td>
                </ng-container>
              </ng-container>
              <ng-container *ngIf="innerCol.click">
                <!--解析引用類型中可以點擊的-->
                <ng-container *ngIf="iCol === 2">
                  <!--解析可以點擊的RFQ-->
                  <td>
                    <a [routerLink]="['/dashboard/dfc/model-moh']"
                      [queryParams]="{modelID: innerCol.modelID, stage: innerCol.stage, modelGroupType: innerCol.groupModelType, plant: innerCol.plant, modelType: innerCol.modelType, standardType: innerCol.check, modelName: innerCol.modelName}"
                      [ngStyle]="innerCol.style" style="text-decoration: underline" target="_blank">
                      {{innerCol.target}}
                    </a>
                  </td>
                </ng-container>
                <ng-container *ngIf="iCol !== 2">
                  <!--解析其他可以點擊製程-->
                  <td>
                    <a [routerLink]="['/dashboard/dfc/model-moh']"
                      [queryParams]="{modelID: innerCol.modelID, stage: innerCol.stage, modelGroupType: innerCol.groupModelType, plant: innerCol.plant, modelType: innerCol.modelType, standardType: innerCol.check, modelName: innerCol.modelName}"
                      [ngStyle]="innerCol.style" style="text-decoration: underline" target="_blank">
                      {{innerCol.cost}}
                    </a>
                  </td>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </tr>
    </tbody>
  </nz-table>
  </td>
  </tr>
  </ng-template>
  </tbody>
  </nz-table>
</div>

<nz-table hidden="true" id="dfcSummaryMohDown" #dfcSummaryMohDownTable [nzData]="dataSet" [nzFrontPagination]=false
  nzBordered>
  <thead>
    <tr>
      <th rowspan="2">{{'mrr.mrr-site' | translate}}</th>
      <th rowspan="2">{{'mrr.mrr-customer' | translate}}</th>
      <th rowspan="2">{{'mrr.mrr-product' | translate}}</th>
      <th rowspan="2">Project Code</th>
      <th rowspan="2">Project Name</th>
      <th rowspan="2">Model Name</th>
      <th rowspan="2">Current Stage</th>
      <th rowspan="2">MP Date</th>
      <th rowspan="2">FCST(K/{{'military-order.month' | translate}})</th>
      <th rowspan="1" colspan="2">RFQ</th>
      <th rowspan="1">C0</th>
      <th rowspan="1">C1</th>
      <th rowspan="1">C2</th>
      <th rowspan="1">C3</th>
      <th rowspan="1">C4</th>
      <th rowspan="1">C5</th>
      <th rowspan="1">C6</th>
    </tr>
    <tr>
      <th>{{'report.dfc-am-quoted-price' | translate}}</th>
      <th>{{'report.goal-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
      <th>{{'report.design-moh' | translate}}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let row of dfcSummaryMohDownTable.data">
      <!-- 如果為 groupModel 則顯示展開的加號 -->
      <ng-container *ngFor="let col of row; index as i">
        <ng-container *ngIf="isColIndex(i)">
          <ng-container *ngIf="!isObjectType(col)">
            <!--解析基礎類型-->
            <td>{{col}}</td>
          </ng-container>
          <ng-container *ngIf="isObjectType(col)">
            <!--解析引用類型-->
            <ng-container *ngIf="!col.click">
              <!--解析引用類型中的不可點擊的-->
              <ng-container *ngIf="i === 10">
                <!--解析不可點擊的RFQ-->
                <td>{{col.cost}}</td>
                <td>{{col.target}}</td>
              </ng-container>
              <ng-container *ngIf="i !== 10">
                <!--解析的其他不可點擊製程-->
                <td>{{col.cost}}</td>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="col.click">
              <!--解析引用類型中可以點擊的-->
              <ng-container *ngIf="i === 10">
                <!--解析可以點擊的RFQ-->
                <td>{{col.cost}}</td>
                <td><a routerLink="/dashboard/dfc/model-moh/{{col.plant}}/{{col.stageID}}/{{col.check}}"
                    style="text-decoration: underline" target="_blank">{{col.target}}</a></td>
              </ng-container>
              <ng-container *ngIf="i !== 10">
                <!--解析其他可以點擊製程-->
                <td><a routerLink="/dashboard/dfc/model-moh/{{col.plant}}/{{col.stageID}}/{{col.check}}"
                    [ngStyle]="col.style" target="_blank">{{col.cost}}</a></td>
              </ng-container>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </tr>
  </tbody>
</nz-table>