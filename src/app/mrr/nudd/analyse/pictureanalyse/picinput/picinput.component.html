<div>
  <div *ngIf="afterAnalyse && analysisShow" class="overall" style="display: inline-flex;margin-left:22%">
    <table>
      <thead>
        <tr>
          <th width="600" height="40" colspan="4" style="text-align:center">
            Overall ({{'mrr.nudd-totalItem' | translate}}:{{green.length+yellow.length+red.length}})</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="toolalert" width="200" height="40" style="text-align:center">
            <span class="green-circle" style="display: inline-block;"></span>
            {{green.length}}
            <span class="tooltiptext">
              <table style="width:100%">
                <tr class="title">
                  <th colspan="2">{{'mrr.nudd-light-judgment-standard' | translate}}</th>
                </tr>
                <tr class="title">
                  <th>{{'mrr.nudd-scoreInterval' | translate}}</th>
                  <th>{{'mrr.nudd-lightDisplay' | translate}}</th>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">16 ~ 20</td>
                  <td style="background-color: rgba(212, 48, 48, 1);  color: black;">{{'mrr.nudd-highRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">12 ~ 15</td>
                  <td style="background-color: rgb(248, 252, 55);  color: black;">{{'mrr.nudd-mediumRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">4 ~ 11</td>
                  <td style="background-color: rgb(6, 238, 26);  color: black;">{{'mrr.nudd-lowRisk' | translate}}</td>
                </tr>
              </table>
            </span>
          </td>
          <td class="toolalert" width="200" height="40" style="text-align:center">
            <span class="orange-circle" style="display: inline-block;"></span>
            {{yellow.length}}
            <span class="tooltiptext">
              <table style="width:100%">
                <tr class="title">
                  <th colspan="2">{{'mrr.nudd-light-judgment-standard' | translate}}</th>
                </tr>
                <tr class="title">
                  <th>{{'mrr.nudd-scoreInterval' | translate}}</th>
                  <th>{{'mrr.nudd-lightDisplay' | translate}}</th>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">16 ~ 20</td>
                  <td style="background-color: rgba(212, 48, 48, 1);  color: black;">{{'mrr.nudd-highRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">12 ~ 15</td>
                  <td style="background-color: rgb(248, 252, 55);  color: black;">{{'mrr.nudd-mediumRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">4 ~ 11</td>
                  <td style="background-color: rgb(6, 238, 26);  color: black;">{{'mrr.nudd-lowRisk' | translate}}</td>
                </tr>
              </table>
            </span>
          </td>
          <td class="toolalert" width="200" height="40" style="text-align:center">
            <span class="red-circle" style="display: inline-block;"></span>
            {{red.length}}
            <span class="tooltiptext">
              <table style="width:100%">
                <tr class="title">
                  <th colspan="2">{{'mrr.nudd-light-judgment-standard' | translate}}</th>
                </tr>
                <tr class="title">
                  <th>{{'mrr.nudd-scoreInterval' | translate}}</th>
                  <th>{{'mrr.nudd-lightDisplay' | translate}}</th>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">16 ~ 20</td>
                  <td style="background-color: rgba(212, 48, 48, 1);  color: black;">{{'mrr.nudd-highRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">12 ~ 15</td>
                  <td style="background-color: rgb(248, 252, 55);  color: black;">{{'mrr.nudd-mediumRisk' | translate}}
                  </td>
                </tr>
                <tr>
                  <td style="color: black;background-color: #ccc">4 ~ 11</td>
                  <td style="background-color: rgb(6, 238, 26);  color: black;">{{'mrr.nudd-lowRisk' | translate}}</td>
                </tr>
              </table>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="mrr-btn-download">
    <button nz-button *ngIf="mailReceiver &&afterAnalyse && analysisShow" [nzType]="'primary'" title="Notice"
      nzShape="circle" (click)="notice()">
      <i class="anticon anticon-notification"></i>
    </button>
    <button *ngIf="afterAnalyse && analysisShow" nz-button [nzType]="'primary'" title="Save" nzShape="circle"
      (click)="save()">
      <i class="anticon anticon-save"></i>
    </button>
    <button nz-button *ngIf="inputShow || afterAnalyse" [nzType]="'primary'" title="Download" nzShape="circle"
      (click)="download()">
      <i class="anticon anticon-download"></i>
    </button>
  </div>
</div>
<br><br>
<nz-table id="datatable" #analyseTable [nzData]="dataSet" nzShowPagination="false" [nzPageSize]="500">
  <thead>
    <tr>
      <th>Dimension</th>
      <th>Part</th>
      <th>ProcessType</th>
      <th>Item</th>
      <th>Side</th>
      <th>Point</th>
      <th>Value</th>
      <th *ngIf="afterAnalyse">{{'mrr.nudd-riskScore' | translate}}</th>
      <th *ngIf="afterAnalyse">L.L</th>
      <th *ngIf="dimension==='3D'">{{'mrr.nudd-schematic-diagram' | translate}}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of analyseTable.data, let i=index">
      <td>{{data.dimension}}</td>
      <td>{{data.part}}</td>
      <td>{{data.processType}}</td>
      <td *ngIf="data.processType!=='Other'">{{data.itemName}}({{data.item}})</td>
      <td *ngIf="data.processType==='Other'"><input type="text" nz-input [(ngModel)]="editProcess[data.key]"></td>
      <td *ngIf="data.processType!=='Other'">{{data.sideName}}({{data.side}})</td>
      <td *ngIf="data.processType==='Other'">{{data.sideName}}</td>
      <td>{{data.point}}</td>
      <td *ngIf="data.processType!=='Other'">
        <span *ngIf="afterAnalyse">{{editCache[data.key]}}</span>
        <span *ngIf="!afterAnalyse">
          <input type="text" *ngIf="!data.isFactNumeric" nz-input [(ngModel)]="editCache[data.key]">
          <nz-select nzShowSearch *ngIf="data.isFactNumeric" style="width: 300px;" [(ngModel)]="editCache[data.key]">
            <ng-container *ngFor="let value of valueList">
              <nz-option [nzValue]="value" [nzLabel]="value"></nz-option>
            </ng-container>
          </nz-select>
        </span>
      </td>
      <td *ngIf="data.processType==='Other'"></td>
      <td *ngIf="afterAnalyse" style="text-align:center;">{{data.level}}</td>
      <td *ngIf="afterAnalyse &&data.level>=16"><a *ngFor="let item of data.lessonLearned"
          (click)="downloadLL(item.fileName)">{{item.fileName}}<br></a></td>
      <td *ngIf="afterAnalyse &&data.level<16"></td>
      <td *ngIf="dimension==='3D' && data.processType!=='Other'" style="margin-left:5px"><img *ngIf="data.picPath"
          height="30px" (click)="clickEventHandler(data.picPath)" id="image" [src]="data.picPath"></td>
      <td *ngIf="dimension==='3D' && data.processType==='Other'"></td>
    </tr>
  </tbody>
</nz-table>
<br>
<div style="text-align: center">
  <button *ngIf="!afterAnalyse" nz-button nzType="primary" style="border-radius:6px" (click)="paramAnalyse()"
    [disabled]="false">{{'mrr.nudd-analysis' | translate}}</button>
</div>

<!-- 刪除后提示 -->
<nz-modal nzWrapClassName="vertical-center-modal" [nzWidth]="282" [nzStyle]="{ height: '202px' }"
  [(nzVisible)]="isSaveVisible" [nzClosable]="false" [nzCancelText]="null" [nzOkText]="null" [nzFooter]="null"
  nzTitle="">
  <div class="dfc-delAfter-icon">
    <i class="anticon anticon-check"></i>
  </div>
  <div class="dfc-delAfter-text">
    <span>{{'mrr.mrr-saved-successfully' | translate}}</span>
  </div>
</nz-modal>

<nz-modal *ngIf="isVisiblePic" [nzWidth]="1220" [(nzVisible)]="isVisiblePic" [nzClosable]="false"
  (nzOnCancel)="handleCancel()" [nzFooter]="null" nzTitle="">
  <img width="100%" [src]="imageUrl">
</nz-modal>